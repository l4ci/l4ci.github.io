<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Meeting-Kostenrechner - Machen Sie die versteckten Kosten von Besprechungen sichtbar">
  <meta name="keywords" content="Meeting, Kosten, Rechner, Calculator, ProduktivitÃ¤t">
  <base href="./">
  <title>ğŸ’° Meeting-Kostenrechner</title>
  
  <!-- External Dependencies -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- Local Styles -->
  <link rel="stylesheet" href="./css/styles.css">
</head>
<body class="min-h-screen flex items-center justify-center relative p-4" x-data="meetingCalculator()" x-init="init()">

  <!-- Notification Container (Fixed Position) -->
  <div class="notification-container" role="alert" aria-live="polite" aria-atomic="true">
    <div x-show="notification.visible" 
         x-transition
         class="notification p-4 rounded-lg text-center font-medium"
         :class="notification.class"
         x-text="notification.message">
    </div>
  </div>

  <!-- Info Modal -->
  <div x-show="infoOpen" 
       x-cloak
       @click.self="infoOpen = false"
       @keydown.escape.window="infoOpen && closeInfoModal()"
       class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop"
       role="dialog"
       aria-modal="true"
       aria-labelledby="infoTitle"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0">
    <div class="glass-container rounded-2xl p-6 md:p-8 max-w-md w-full info-popup"
         @click.stop
         x-trap.inert.noscroll="infoOpen"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95">
      <div class="flex justify-between items-start mb-4">
        <h2 id="infoTitle" class="text-2xl font-bold" style="color: var(--text-primary);">
          ğŸ’¡ <span x-text="t('infoTitle')"></span>
        </h2>
        <button @click="closeInfoModal()" 
                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 text-2xl leading-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded"
                aria-label="Close dialog"
                tabindex="0">
          Ã—
        </button>
      </div>
      <div class="space-y-4" style="color: var(--text-secondary);">
        <p x-text="t('infoText1')"></p>
        <p x-text="t('infoText2')"></p>
        <div class="bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500 p-4 rounded">
          <p class="font-semibold mb-2" style="color: var(--blue-500);">
            <span x-text="t('infoExampleTitle')"></span>
          </p>
          <p class="text-sm" x-text="t('infoExample')"></p>
        </div>
        <p class="text-sm italic" x-text="t('infoTip')"></p>
      </div>
      <button @click="closeInfoModal()" 
              class="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
              tabindex="0">
        <span x-text="t('infoClose')"></span>
      </button>
    </div>
  </div>

  <div id="appContainer" class="glass-container p-6 md:p-8 rounded-2xl shadow-2xl max-w-lg w-full">
    <!-- Header with Language, Theme Toggle and Info -->
    <div class="flex justify-between items-center mb-6">
      <!-- Language Selector -->
      <div class="language-dropdown" x-data="{ open: false }" @click.away="open = false">
        <button @click="open = !open" 
                class="text-sm px-3 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
                :aria-label="t('toggleLanguage')"
                :aria-expanded="open"
                style="background-color: var(--bg-tertiary); color: var(--text-secondary);">
          <span x-text="languageFlag + ' ' + language.toUpperCase()"></span>
        </button>
        <div x-show="open" 
             x-cloak
             x-transition
             class="language-menu"
             role="menu"
             @keydown.escape="open = false">
          <button @click="setLanguage('de'); open = false" 
                  :class="{ 'active': language === 'de' }"
                  role="menuitem"
                  tabindex="0">
            ğŸ‡©ğŸ‡ª Deutsch
          </button>
          <button @click="setLanguage('en'); open = false" 
                  :class="{ 'active': language === 'en' }"
                  role="menuitem"
                  tabindex="0">
            ğŸ‡¬ğŸ‡§ English
          </button>
          <button @click="setLanguage('es'); open = false" 
                  :class="{ 'active': language === 'es' }"
                  role="menuitem"
                  tabindex="0">
            ğŸ‡ªğŸ‡¸ EspaÃ±ol
          </button>
          <button @click="setLanguage('fr'); open = false" 
                  :class="{ 'active': language === 'fr' }"
                  role="menuitem"
                  tabindex="0">
            ğŸ‡«ğŸ‡· FranÃ§ais
          </button>
          <button @click="setLanguage('it'); open = false" 
                  :class="{ 'active': language === 'it' }"
                  role="menuitem"
                  tabindex="0">
            ğŸ‡®ğŸ‡¹ Italiano
          </button>
          <button @click="setLanguage('pl'); open = false" 
                  :class="{ 'active': language === 'pl' }"
                  role="menuitem"
                  tabindex="0">
            ğŸ‡µğŸ‡± Polski
          </button>
        </div>
      </div>
      
      <button @click="openInfoModal()" 
              class="info-icon focus:outline-none focus:ring-2 focus:ring-blue-500"
              :aria-label="t('showInfo')"
              tabindex="0">
        i
      </button>
      
      <button @click="toggleTheme()" 
              class="text-sm px-3 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
              :aria-label="t('toggleTheme')"
              style="background-color: var(--bg-tertiary); color: var(--text-secondary);">
        <span x-text="theme === 'dark' ? 'â˜€ï¸' : theme === 'light' ? 'ğŸŒ™' : 'ğŸŒ“'"></span>
      </button>
    </div>

    <h1 class="text-2xl md:text-3xl font-bold text-center mb-8" x-text="t('title')"></h1>
    
    <!-- Cost and Time Display -->
    <div class="text-center mb-8">
      <p class="text-5xl md:text-6xl font-bold mb-3" style="color: var(--blue-500);" aria-live="polite" x-text="formattedTotalCost"></p>
      <p class="text-xl md:text-2xl font-medium time-display" style="color: var(--text-secondary);" aria-live="polite">
        â±ï¸ <span x-text="formattedElapsedTime"></span>
      </p>
    </div>

    <!-- Control Buttons -->
    <div class="flex items-center justify-between gap-4 mb-6">
      <button @click="toggleTimer()" 
              class="px-6 py-3 rounded-lg flex-1 font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2"
              :style="`background-color: ${isRunning ? (isDarkTheme ? '#fbbf24' : '#eab308') : (isDarkTheme ? '#60a5fa' : '#3b82f6')}`"
              :aria-label="isRunning ? t('pause') : t('start')">
        <span x-text="isRunning ? t('pause') : t('start')"></span>
      </button>
      <button @click="resetTimer()" 
              class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex-1 font-medium focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
              :aria-label="t('reset')">
        <span x-text="t('reset')"></span>
      </button>
    </div>

    <!-- People Counter - Prominently Placed -->
    <div class="mb-6 p-4 rounded-lg border-2 gradient-bg shadow-lg" style="border-color: var(--blue-500);">
      <div class="flex items-center justify-between">
        <label for="numberOfPeopleInput" class="block font-bold text-lg" x-text="t('participants')"></label>
        <div class="flex items-center space-x-3">
          <button @click="updatePeopleCount(-1)" 
                  class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-bold text-xl w-10 h-10 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
                  :aria-label="t('decreaseParticipants')">
            âˆ’
          </button>
          <div class="person-badge px-6 py-2 rounded-lg border-2 shadow-sm" style="border-color: var(--blue-500);">
            <input type="number" 
                   id="numberOfPeopleInput" 
                   x-model.number="currentPeopleCount"
                   @input="onPeopleInputChange()"
                   class="w-12 text-center text-2xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" 
                   style="background: transparent; color: var(--blue-500);"
                   min="1"
                   :aria-label="t('numberOfParticipants')">
          </div>
          <button @click="updatePeopleCount(1)" 
                  class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xl w-10 h-10 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
                  :aria-label="t('increaseParticipants')">
            +
          </button>
        </div>
      </div>
    </div>

    <!-- Settings Section -->
    <div class="mb-6">
      <button @click="settingsOpen = !settingsOpen" 
              class="px-4 py-3 rounded-lg w-full text-left font-medium transition-colors hover:opacity-80 focus:outline-none focus:ring-2 focus:ring-blue-500"
              style="background-color: var(--bg-tertiary); color: var(--text-primary);"
              :aria-expanded="settingsOpen"
              aria-controls="configSection">
        <span x-text="settingsOpen ? t('settingsHide') : t('settingsShow')"></span>
      </button>
      <div x-show="settingsOpen" 
           x-collapse
           id="configSection" 
           class="mt-4 space-y-4 p-4 rounded-lg config-section" 
           role="region">
        <div>
          <label for="costPerPerson" class="block font-medium mb-1" style="color: var(--text-primary);" x-text="t('costPerPerson')"></label>
          <input type="number" 
                 id="costPerPerson" 
                 x-model.number="costPerPerson"
                 @input="updateCost()"
                 class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                 style="background-color: var(--bg-secondary); color: var(--text-primary); border-color: var(--border-color);"
                 min="0" 
                 step="0.01">
        </div>

        <div>
          <label for="currency" class="block font-medium mb-1" style="color: var(--text-primary);" x-text="t('currency')"></label>
          <select id="currency" 
                  x-model="currency"
                  @change="updateCost()"
                  class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                  style="background-color: var(--bg-secondary); color: var(--text-primary); border-color: var(--border-color);">
            <option value="EUR">Euro (â‚¬)</option>
            <option value="USD">US-Dollar ($)</option>
            <option value="GBP">Britisches Pfund (Â£)</option>
            <option value="CHF">Schweizer Franken (CHF)</option>
            <option value="JPY">Japanischer Yen (Â¥)</option>
            <option value="CNY">Chinesischer Yuan (Â¥)</option>
            <option value="INR">Indische Rupie (â‚¹)</option>
            <option value="AUD">Australischer Dollar (A$)</option>
            <option value="CAD">Kanadischer Dollar (C$)</option>
            <option value="BRL">Brasilianischer Real (R$)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Meeting History -->
    <div>
      <button @click="historyOpen = !historyOpen" 
              class="text-sm underline transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 rounded"
              style="color: var(--text-secondary);"
              :aria-expanded="historyOpen"
              aria-controls="historySection">
        <span x-text="historyOpen ? t('historyHide') : t('historyShow')"></span>
      </button>
      <div x-show="historyOpen" 
           x-collapse
           id="historySection" 
           class="mt-2 p-3 rounded-lg text-sm history-section" 
           role="region">
        <p class="font-medium mb-2" style="color: var(--text-primary);" x-text="t('historyTitle')"></p>
        <ul class="space-y-1" style="color: var(--text-secondary);">
          <template x-for="(segment, index) in segments" :key="index">
            <li x-text="formatHistoryEntry(segment, index)"></li>
          </template>
        </ul>
      </div>
    </div>
  </div>

  <!-- Emoji Container -->
  <div id="emojiContainer" aria-hidden="true"></div>

  <!-- Local Scripts - Load in correct order -->
  <script src="./js/config.js"></script>
  <script src="./js/translations.js"></script>
  <script src="./js/app.js"></script>
</body>
</html>
